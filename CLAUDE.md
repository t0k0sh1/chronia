# CLAUDE.md

このファイルは、Claude Code（claude.ai/code）がこのリポジトリ内のコードを扱う際のガイダンスを提供します。

## 共通のルール

- 会話はすべて日本語で行ってください
- 判断が必要な場合は、必ず手を止めて判断を仰いでください
- コード内のコメントはすべてアメリカ英語を使ってください

## 共通の開発コマンド

- **テスト**: `npm test` (uses Vitest)
- カバレッジ付きテスト：`npx vitest run --coverage`
- **Lint**: `npm run lint` (ESLint with TypeScript)
- **ビルド**: `npm run build` (ESM と CJS の両方のモジュールを作成)
- **クリーン**: `npm run clean` (dist/ ディレクトリを削除)
- **ドキュメント生成**: `npx typedoc` (docs/ ディレクトリにAPIドキュメントを生成)

## コミット前にやること

**IMPORTANT**: あらゆるコミットを作成する前に必ず実施すること（MUST）

1. 修正したコードとJSDocコメントを突き合わせて、外部仕様に変更があればJSDocコメントを最新化します
1. `npm run lint` を実行して、コード品質とスタイルの一貫性を確認します
1. `npm run build` を実行して、ESM/CJS形式のバンドルをビルドします
1. `npx typedoc` を実行して、最新のドキュメントを生成します
1. dist/、docs/、および（更新があれば）README.md をコミットに追加します

これにより、ビルド成果物、APIドキュメント、ユーザードキュメントが常にソースコードの変更内容と整合する状態を保てます。

## プロジェクト構成

このプロジェクトは、ESM/CJS の両モジュール形式をサポートする TypeScript 製の日付・時刻ユーティリティライブラリです。

### コア構成

- src/index.ts：すべてのユーティリティを再エクスポートするメインエントリーポイント
- src/i18n/：ロケール別のフォーマットデータ（例：en-US、ja）
- src/\_lib/：内部で共有されるユーティリティ群

提供する関数は、src/addDays/index.ts のような形で src/ に関数名のディレクトリを作成し、中に index.ts を置く形で実装されています。

### テスト構成

- Vitest を使用し、テーブル駆動テスト（`it.each`）を採用
- 境界値テストを含む包括的なテストを実施
- 通常ケースと例外的ケース（うるう年、紀元前の日付など）の両方をカバー
- ローカライズ機能のテストでは、モック化した `localize` オブジェクトを使用

### テストファイルの配置

- **ユニットテスト**：`tests/` ディレクトリに配置し、ソース構造をミラーリングすること
  - 例：`src/isValid/index.ts` → `tests/isValid.test.ts`
  - 例：`src/_lib/validators.ts` → `tests/_lib/validators.test.ts`
- **契約テスト（Contract Tests）**：`specs/[feature]/contracts/` ディレクトリに配置すること
  - 機能開発中に実装契約を検証するためのテスト
  - 例：`specs/007-improvement-of-isvalid/contracts/internal-validator-usage.test.ts`

### ビルド構成

- **tsconfig.json**：基本的な TypeScript 設定ファイル
- 出力は `dist/` ディレクトリに生成され、モジュール形式ごとに分かれたディレクトリと型定義ファイルが含まれます

## コード品質ガイドライン

### 文字列リテラル

- TypeScript／JavaScript のコードでは、**必ず** 文字列リテラルにダブルクォート（`"`）を使用すること
- これは ESLint の設定およびプロジェクトのコーディング規約との整合性を保つためです
- 例：`return typeof value === "number"`（正しい） vs `return typeof value === 'number'`（誤り）

### 比較演算子

- **常に** 厳密な比較演算子（`===` および `!==`）を使用すること
- 抽象的な比較演算子（`==` および `!=`）は型変換による予期しない動作を招くため、使用を禁止します
- このルールは ESLint の設定（`eqeqeq: "error"`）とも一致しています
- 例：
  - 正しい：`if (value === null)`
  - 誤り：`if (value == null)`

### 型安全性

- **any** 型の使用は禁止します。必要な場合は `unknown` を使用し、明示的に型ガードを行うこと
- `as` による型アサーションは最小限にとどめ、型推論で解決できるように設計すること
- すべての公開関数は明示的に戻り値型を指定すること（型推論に依存しない）

### コーディングスタイル

- 関数名・変数名はキャメルケースを使用し、定数のみ大文字スネークケースを使用します
- 未使用の変数・インポートはコミット前に削除してください
- ファイル末尾には必ず改行を入れてください

### エラー処理ポリシー

- 例外は原則として使用しない
- 戻り値がDate型の場合は`new Date(NaN)`、number型の場合は`NaN`を返すこと
- 仕様上、どうしても例外を投げる必要がある場合は、必ず手を止めて判断を仰いでください

### 関数追加・修正ルール

- 新しい関数を追加する場合は、既存の構造に従って `src/[functionName]/index.ts` に配置すること
- 公開関数（エクスポート対象）は必ず単体テストとJSDocを伴うこと
- 破壊的変更（既存関数のシグネチャ変更、削除など）は事前にレビューを経て行うこと
- すべての関数には少なくとも1つの境界値テストを含めること

### 実装確認

- **重要事項**：タスクを完了した後は、以下のコマンドを順番に実行してコード品質を確認すること
  1. 修正したコードとJSDocコメントを突き合わせて、外部仕様に変更があればJSDocコメントを最新します
  2. `npm run lint` - Lintエラーおよびコードスタイルの問題を確認します
  3. `npm test` - すべてのテストが成功することを確認します
  4. `npx vitest run --coverage` - カバレッジ付きテストを実行して、カバレッジが100%であることを確認します
  5. `npm run build` - コードが正常にビルドされることを確認します
- いずれかのコマンドが失敗した場合は、修正してから次に進む、またはコミットすること
- Lint、テスト、またはビルドに失敗した状態のコードをコミットしてはいけません
- 修正範囲外でエラーが発生した場合は、必ず手を止めて判断を仰いでください
