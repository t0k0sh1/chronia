# 機能仕様: compare()関数の第3引数をオプションオブジェクトに変更

**フィーチャーブランチ**: `012-change-the-third`
**作成日**: 2025-01-14
**ステータス**: 承認済み（計画フェーズ準備完了）
**入力**: ユーザー説明: "Change the third argument of the compare function to options"

## 実行フロー (main)
```
1. 入力からユーザー説明を解析
   → 機能説明が提供された: compare()の第3引数を変更
2. 説明から主要な概念を抽出
   → アクター: chroniaライブラリを使用する開発者
   → アクション: compare()関数のシグネチャをリファクタリング
   → データ: orderパラメータ（現在: 文字列、将来: optionsオブジェクト）
   → 制約: 破壊的変更（メジャーバージョンアップが必要）
3. 明確化事項:
   → optionsパラメータは必須とし、デフォルト値{ order: "ASC" }を提供
   → 古い文字列ベースのAPIは廃止（後方互換性なし）
   → メジャーバージョンアップで破壊的変更として実施
4. ユーザーシナリオとテストセクションを記入
   → ユーザーフローを特定: 開発者がoptionsを使用してcompare()を呼び出す
5. 機能要件を生成
   → 各要件はテスト可能
   → 一部の要件は明確化が必要とマーク
6. 主要エンティティを特定（データが関係する場合）
   → optionsオブジェクト構造を特定
7. レビューチェックリストを実行
   → 警告 "仕様に不確実性あり" - 移行戦略の明確化が必要
8. 戻り値: 成功（明確化を伴う計画準備完了）
```

---

## ⚡ クイックガイドライン
- ✅ ユーザーが何を必要とし、なぜ必要なのかに焦点を当てる
- ❌ 実装方法を避ける（技術スタック、API、コード構造は含めない）
- 👥 開発者ではなく、ビジネス関係者向けに記述

---

## ユーザーシナリオとテスト

### 主要なユーザーストーリー
chroniaライブラリを使用する開発者として、文字列パラメータではなくoptionsオブジェクトを使用して`compare()`関数にソートオプションを渡したい。これにより、APIがより拡張可能になり、optionsオブジェクトを受け入れる他のライブラリ関数と一貫性が保たれる。

### 受け入れシナリオ

1. **前提条件** 開発者が比較する2つの日付を持っている、**実行** `compare(date1, date2, { order: "DESC" })`を呼び出す、**結果** 関数は降順で比較結果を返す

2. **前提条件** 開発者がデフォルトの昇順を望んでいる、**実行** 第3引数なしで`compare(date1, date2)`を呼び出す、**結果** 関数は昇順で比較結果を返す

3. **前提条件** 開発者が`order: "ASC"`を含むoptionsオブジェクトを提供する、**実行** `compare(date1, date2, { order: "ASC" })`を呼び出す、**結果** 関数は昇順で比較結果を返す

4. **前提条件** 開発者が空のoptionsオブジェクトを提供する、**実行** `compare(date1, date2, {})`を呼び出す、**結果** 関数はデフォルトで昇順になる

5. **前提条件** 開発者が古い文字列ベースのAPI `compare(date1, date2, "DESC")`を使用する、**実行** TypeScriptコンパイル時、**結果** 型エラーが発生する（破壊的変更のため、古いAPIは使用不可）

### エッジケース
- optionsオブジェクトに無効な値が含まれている場合はどうなるか（例: `{ order: "invalid" }`）？
- optionsオブジェクトに追加の未知のプロパティが含まれている場合はどうなるか？
- options引数として`null`または`undefined`が渡された場合、システムはどう処理するか？
- optionsオブジェクトが有効な構造を持つが大文字小文字が異なる場合はどうなるか（例: `{ order: "desc" }` vs `{ order: "DESC" }`）？

## 要件

### 機能要件

- **FR-001**: システムは`compare()`関数の第3パラメータとしてoptionsオブジェクトを受け入れなければならない
- **FR-002**: optionsオブジェクトは"ASC"または"DESC"の値を受け入れる`order`プロパティをサポートしなければならない
- **FR-003**: optionsパラメータが省略された場合、システムはデフォルトで昇順（"ASC"）にしなければならない
- **FR-004**: optionsオブジェクトが空の場合、システムはデフォルトで昇順（"ASC"）にしなければならない
- **FR-005**: orderプロパティに無効な値が含まれている場合、システムはデフォルトで昇順（"ASC"）にしなければならない
- **FR-006**: システムは大文字小文字を区別しないorder値を処理しなければならない（例: "asc"、"Asc"、"ASC"はすべて昇順として扱う）
- **FR-007**: システムは既存の比較ロジックを維持しなければならない（-1、0、または1を返す）
- **FR-008**: システムは最初の2つの引数としてDateオブジェクトと数値タイムスタンプのサポートを継続しなければならない
- **FR-009**: システムは後方互換性を保持しない。これは破壊的変更だが、v1.0.0リリース前のため、現在のバージョン（v1.0.0）で実施可能
- **FR-010**: システムはoptionsオブジェクトのTypeScript型定義を通じて型安全性を維持しなければならない
- **FR-011**: システムは第3パラメータとして`null`および`undefined`を処理し、昇順をデフォルトにしなければならない
- **FR-012**: システムはoptionsオブジェクト内の未知のプロパティをエラーをスローせずに無視しなければならない

### 主要エンティティ

- **CompareOptions**: 比較設定を含むオブジェクト
  - "ASC"または"DESC"の値を持つオプションの`order`プロパティを含む
  - 将来的に追加の比較オプションで拡張可能（例: ロケール対応の比較、カスタム比較関数）
  - 日付の比較方法に関するユーザー設定を表す

---

## レビューと受け入れチェックリスト

### コンテンツ品質
- [x] 実装の詳細なし（言語、フレームワーク、API）
- [x] ユーザー価値とビジネスニーズに焦点を当てている
- [x] 非技術的な関係者向けに記述されている
- [x] すべての必須セクションが完了している

### 要件の完全性
- [x] [要明確化]マーカーが残っていない
- [x] 要件はテスト可能で曖昧さがない
- [x] 成功基準は測定可能
- [x] スコープが明確に定義されている
- [x] 依存関係と前提条件が特定されている

---

## 実行ステータス

- [x] ユーザー説明を解析
- [x] 主要概念を抽出
- [x] 曖昧さをマークおよび明確化を実施
- [x] ユーザーシナリオを定義
- [x] 要件を生成
- [x] エンティティを特定
- [x] レビューチェックリストに合格

---

## 計画フェーズのための注記

### 明確化済み事項
1. **移行戦略**: 破壊的変更として実施。古い文字列ベースのAPIは廃止し、新しいoptionsオブジェクト形式のみをサポート
2. **パラメータ設計**: 第3引数`options`は必須パラメータとし、デフォルト値`{ order: "ASC" }`を提供
3. **バージョン戦略**: v1.0.0リリース前のため、破壊的変更を許容。現在のバージョン（v1.0.0）でそのまま実施可能

### 将来の拡張の可能性
optionsオブジェクト構造により、次のような将来の機能強化が可能になります:
- 特殊な日付処理のためのカスタム比較関数
- ロケール対応の比較設定
- null/undefinedの処理設定
- パフォーマンス最適化のヒント

### 設計上の考慮事項
- optionsオブジェクトパターンは位置パラメータよりも拡張性が高い
- 業界のベストプラクティスに準拠（`Array.sort()`と比較関数に類似）
- より良いTypeScript IntelliSenseサポートを提供
- 破壊的変更なしに将来新しいオプションを追加しやすい
