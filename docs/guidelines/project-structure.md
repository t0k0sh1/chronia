# Project Structure

## Directory Layout

```
chronia/
├── src/                      # Source code
│   ├── addDays/
│   │   └── index.ts         # One function per directory
│   ├── addMonths/
│   │   └── index.ts
│   ├── _lib/                # Internal utilities (not exported)
│   │   ├── validators.ts
│   │   ├── truncateToUnit.ts
│   │   ├── tokenize.ts
│   │   ├── formatters/
│   │   │   ├── index.ts
│   │   │   └── tokens/      # Individual token formatters
│   │   └── parsers/
│   │       ├── index.ts
│   │       └── tokens/      # Individual token parsers
│   ├── i18n/                # Locale definitions
│   │   ├── en.ts           # English locale
│   │   └── ja.ts           # Japanese locale
│   ├── types.ts             # TypeScript type definitions
│   ├── constants.ts         # MIN_DATE, MAX_DATE
│   └── index.ts             # Public API exports
├── tests/                   # Test files (mirrors src/)
│   ├── addDays.test.ts
│   ├── addMonths.test.ts
│   └── contract/            # Contract tests
├── docs/                    # AI-focused documentation (NEW)
│   ├── function-categories/
│   ├── guidelines/
│   └── troubleshooting/
├── site/                    # TypeDoc generated docs (RENAMED from docs/)
├── dist/                    # Build output (ESM/CJS)
├── tsconfig.json            # TypeScript configuration
├── tsup.config.ts           # Build configuration
├── vitest.config.ts         # Test configuration
├── eslint.config.js         # Linting rules
└── package.json
```

## File Naming Conventions

- **Function directories**: camelCase matching function name
- **Test files**: `{functionName}.test.ts`
- **Type definitions**: `types.ts` (centralized)
- **Internal utilities**: `_lib/` prefix indicates non-exported
- **Locale files**: ISO 639-1 language codes (`en.ts`, `ja.ts`)

## Module Organization

### Public API Exports (`src/index.ts`)
All public functions and types exported from single entry point:

```typescript
// Functions
export { addDays } from "./addDays";
export { addMonths } from "./addMonths";
// ...

// Types
export type { Locale, Interval, TimeUnit, BoundsType } from "./types";

// Constants
export { MIN_DATE, MAX_DATE } from "./constants";
```

### Internal Utilities (`src/_lib/`)
Not exported publicly. Used by multiple functions:

- **validators.ts**: Input validation helpers
- **truncateToUnit.ts**: Time unit truncation logic
- **tokenize.ts**: Format pattern tokenization
- **formatters/**: Token-based formatting system
- **parsers/**: Token-based parsing system

## Architectural Patterns

### Single Responsibility
Each function directory contains:
- One exported function
- Comprehensive JSDoc
- No side effects
- No dependencies on other functions (except `_lib/`)

### Shared Utilities
Common logic extracted to `_lib/`:
```typescript
// Used by multiple functions
import { isValidDateOrNumber } from "../_lib/validators";
import { truncateToUnit } from "../_lib/truncateToUnit";
```

### Token System Architecture
Format/parse share token system:
```
formatters/
  index.ts          # Maps tokens → formatter functions
  tokens/
    year.ts         # 'y', 'yy', 'yyyy' formatters
    month.ts        # 'M', 'MM', 'MMM', 'MMMM' formatters
    ...

parsers/
  index.ts          # Maps tokens → parser functions
  tokens/
    year.ts         # 'y', 'yy', 'yyyy' parsers
    month.ts        # 'M', 'MM', 'MMM', 'MMMM' parsers
    ...
```

## Build Output Structure

```
dist/
├── index.js          # ESM bundle
├── index.cjs         # CommonJS bundle
├── index.d.ts        # TypeScript declarations
└── index.d.cts       # CJS TypeScript declarations
```

**Build Process:** `tsup` generates dual ESM/CJS with minification.

## Testing Structure

```
tests/
├── addDays.test.ts          # Function-specific tests
├── contract/
│   └── api-contract.test.ts  # API contract validation
└── coverage/                 # Generated coverage reports
```

**Test Coverage Exclusions:**
- `src/types.ts` (type-only file)
- `src/i18n/` (static data)
- Config files

## Documentation Structure

### AI Documentation (`docs/`)
```
docs/
├── README.md                        # AI documentation overview
├── function-categories/
│   ├── arithmetic/
│   │   ├── addition.md
│   │   └── subtraction.md
│   ├── comparison/
│   ├── difference/
│   ├── getter/
│   ├── setter/
│   ├── boundary/
│   ├── truncation/
│   ├── formatting/
│   ├── utility/
│   └── constants/
├── guidelines/
│   ├── development-principles.md
│   ├── project-structure.md       # This file
│   ├── tech-stack.md
│   ├── error-handling.md
│   ├── input-validation.md
│   └── common-use-cases.md
└── troubleshooting/
    ├── common-pitfalls.md
    └── debugging-guide.md
```

### Human Documentation (`site/`)
Generated by TypeDoc from source code JSDoc comments.

## Configuration Files

| File | Purpose |
|------|---------|
| `tsconfig.json` | TypeScript compilation settings |
| `tsup.config.ts` | Build configuration (ESM/CJS dual output) |
| `vitest.config.ts` | Test runner configuration |
| `eslint.config.js` | Linting rules (double quotes, semicolons) |
| `typedoc.json` | Documentation generation (outputs to `site/`) |
| `package.json` | Dependencies, scripts, exports |

## Package Exports

```json
{
  "exports": {
    ".": {
      "import": "./dist/index.js",
      "require": "./dist/index.cjs"
    }
  },
  "types": "./dist/index.d.ts"
}
```

**ESM/CJS Dual Support:** Tree-shakable ESM for modern bundlers, CJS for compatibility.

## Related

- **Development Principles**: See `development-principles.md`
- **Tech Stack**: See `tech-stack.md`
- **Common Use Cases**: See `common-use-cases.md`
